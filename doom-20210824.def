BootStrap: docker
From: nvidia/cuda:11.0.3-cudnn8-devel-ubuntu20.04

%environment
TF_FORCE_GPU_ALLOW_GROWTH=true

%post
apt-get update -q
DEBIAN_FRONTEND=noninteractive \
apt-get install -y \
  python3-dev \
  python3-pip \
  python-opengl \
  wget \
  curl \
  git \
  unzip \
  vim \
  xauth \
  xvfb \
  swig \
  spyder \
  build-essential cmake zlib1g-dev libgtk2.0-dev timidity libwildmidi-dev \
  libboost-all-dev libsdl2-dev libfreetype6-dev libgl1-mesa-dev libglu1-mesa-dev libpng-dev libjpeg-dev libbz2-dev libfluidsynth-dev libgme-dev libopenal-dev zlib1g-dev timidity tar nasm \

export TZ="Asia/Tokyo"

apt-get clean
rm -rf /var/lib/apt/lists/*

#rm /usr/local/bin/python
ln -s /usr/bin/python3 /usr/local/bin/python
unlink /run/shm

python3 -m pip install -q --upgrade pip setuptools

# Math & Utilities
python3 -m pip install -q \
  numpy \
  scipy \
  jupyter \
  ipywidgets \
  tqdm \
  omegaconf \
  keras-tuner \
  matplotlib

# ML & DS libraries
python3 -m pip install -q \
  pandas scikit-learn catboost optuna seaborn

# PyTorch
python3 -m pip install -q \
  torch==1.7.1+cu110 \
  torchvision==0.8.2+cu110 \
  torchaudio==0.7.2 \
  -f https://download.pytorch.org/whl/torch_stable.html

# Tensorflow 2
python3 -m pip install -q \
  tensorflow==2.3.1 \
  tensorflow_probability==0.12.1

# Pybullet
python3 -m pip install -q \
  pybullet==3.0.8 \
  stable_baselines3

# Muzero related
python3 -m pip install -q \
  box2d-py==2.3.8 \
  gym==0.18.0 \
  nevergrad \
  ray

# vizdoom
python3 -m pip install -q \
  vizdoom \
  opencv-python \
  omgifol #for NavDoom

# Dreamer related
python3 -m pip install -q \
  git+https://github.com/astooke/rlpyt.git \
  psutil \
  pyprind \
  pytest \
  dm_control \
  atari_py 

%runscript
